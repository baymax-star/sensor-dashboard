<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Node Environmental Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .node-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .node-label {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(46, 204, 113, 0.3);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .node-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .node-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .node-info h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .node-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .sensors-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .sensor-item {
            text-align: center;
        }

        .sensor-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }

        .sensor-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .sensor-unit {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn:hover, .btn.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .btn.active {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .cards-grid { grid-template-columns: 1fr; }
            .sensors-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± Multi-Node Environmental Monitor</h1>
            <p>Real-time monitoring 4 node sensor dengan teknologi LoRa</p>
        </div>

        <div class="cards-grid" id="cardsGrid">
            <!-- Cards will be generated here -->
        </div>

        <div class="chart-container">
            <div class="chart-title">Grafik Monitoring 24 Jam Terakhir - Semua Node</div>
            <div class="controls">
                <button class="btn active" onclick="setPeriod('24h')">24 Jam</button>
                <button class="btn" onclick="setPeriod('12h')">12 Jam</button>
                <button class="btn" onclick="setPeriod('6h')">6 Jam</button>
            </div>
            <canvas id="sensorChart" width="400" height="200"></canvas>
        </div>
    </div>

    <script>
        // Data nodes
        const nodes = [
            { id: 1, name: 'Area A', location: 'Zona Industri', co2: 425, h2s: 2.5, rssi: -63, battery: 78 },
            { id: 2, name: 'Area B', location: 'Zona Perumahan', co2: 383, h2s: 2.1, rssi: -68, battery: 85 },
            { id: 3, name: 'Area C', location: 'Zona Komersial', co2: 452, h2s: 3.4, rssi: -64, battery: 72 },
            { id: 4, name: 'Area D', location: 'Zona Hijau', co2: 389, h2s: 2.3, rssi: -72, battery: 90 }
        ];

        let chart;
        let currentPeriod = '24h';

        // Generate historical data
        function generateHistoricalData() {
            const data = {};
            const now = new Date();
            
            nodes.forEach(node => {
                data[node.id] = {
                    timestamps: [],
                    co2: [],
                    h2s: []
                };

                for (let i = 24; i >= 0; i--) {
                    const timestamp = new Date(now.getTime() - i * 60 * 60 * 1000);
                    data[node.id].timestamps.push(timestamp);
                    
                    // Generate realistic data with variations
                    const baseCO2 = node.co2 + (Math.random() - 0.5) * 50;
                    const baseH2S = node.h2s + (Math.random() - 0.5) * 2;
                    
                    data[node.id].co2.push(Math.max(300, baseCO2));
                    data[node.id].h2s.push(Math.max(0.5, baseH2S));
                }
            });
            
            return data;
        }

        // Initialize cards
        function initCards() {
            const cardsGrid = document.getElementById('cardsGrid');
            cardsGrid.innerHTML = '';

            nodes.forEach(node => {
                const card = document.createElement('div');
                card.className = 'node-card';
                card.innerHTML = `
                    <div class="node-label">Node ${node.id}</div>
                    <div class="node-header">
                        <div class="node-icon">üè≠</div>
                        <div class="node-info">
                            <h3>${node.name}</h3>
                            <p>${node.location}</p>
                        </div>
                    </div>
                    <div class="sensors-grid">
                        <div class="sensor-item">
                            <div class="sensor-label">CO‚ÇÇ</div>
                            <div class="sensor-value">${node.co2}</div>
                            <div class="sensor-unit">ppm</div>
                        </div>
                        <div class="sensor-item">
                            <div class="sensor-label">H‚ÇÇS</div>
                            <div class="sensor-value">${node.h2s}</div>
                            <div class="sensor-unit">ppm</div>
                        </div>
                        <div class="sensor-item">
                            <div class="sensor-label">RSSI</div>
                            <div class="sensor-value">${node.rssi}</div>
                            <div class="sensor-unit">dBm</div>
                        </div>
                        <div class="sensor-item">
                            <div class="sensor-label">Battery</div>
                            <div class="sensor-value">${node.battery}</div>
                            <div class="sensor-unit">%</div>
                        </div>
                    </div>
                `;
                cardsGrid.appendChild(card);
            });
        }

        // Initialize chart
        function initChart() {
            const ctx = document.getElementById('sensorChart').getContext('2d');
            const historicalData = generateHistoricalData();
            
            // Prepare datasets
            const datasets = [];
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
            const h2sColors = ['#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'];

            nodes.forEach((node, index) => {
                datasets.push({
                    label: `Node ${node.id} CO‚ÇÇ`,
                    data: historicalData[node.id].co2,
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    yAxisID: 'y'
                });

                datasets.push({
                    label: `Node ${node.id} H‚ÇÇS`,
                    data: historicalData[node.id].h2s,
                    borderColor: h2sColors[index],
                    backgroundColor: h2sColors[index] + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    yAxisID: 'y1'
                });
            });

            // Generate labels (hours)
            const labels = historicalData[1].timestamps.map(ts => {
                return ts.getHours().toString().padStart(2, '0') + ':00';
            });

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            labels: { 
                                color: 'white', 
                                font: { size: 11 },
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: 'white',
                            bodyColor: 'white'
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'white', maxTicksLimit: 12 },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'CO‚ÇÇ (ppm)', color: 'white' },
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            min: 300,
                            max: 520
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'H‚ÇÇS (ppm)', color: 'white' },
                            ticks: { color: 'white' },
                            grid: { drawOnChartArea: false },
                            min: 0,
                            max: 6
                        }
                    }
                }
            });
        }

        // Set period
        function setPeriod(period) {
            currentPeriod = period;
            
            // Update active button
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update chart (in a real app, you'd filter the data based on period)
            // For simplicity, we'll just update the title
            const title = `Grafik Monitoring ${period.toUpperCase()} Terakhir - Semua Node`;
            document.querySelector('.chart-title').textContent = title;
        }

        // Initialize dashboard
        function init() {
            initCards();
            initChart();
        }

        // Start when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
